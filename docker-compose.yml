version: '3.8'

networks:
  obama_network:
    ipam:
      driver: default
      config:
        - subnet: 170.0.0.0/16


services:
  obama-app:
    image: obamaapi:latest
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8081:8081"
    environment:
      - DB_URL=${DB_URL}
      - DB_USERNAME=${DB_USERNAME}
      - DB_PASSWORD=${DB_PASSWORD}
#      - SPRING_DATASOURCE_URL=jdbc:h2:mem:obama
#      - SPRING_DATASOURCE_USERNAME=sa
#      - SPRING_DATASOURCE_PASSWORD=password
#      - SPRING_H2_CONSOLE_ENABLED=true
#      - SPRING_H2_CONSOLE_PATH=/h2-console
#      - SPRING_H2_CONSOLE_SETTINGS_WEB_ALLOW_OTHERS=true
    networks:
      obama_network:
        ipv4_address: 170.0.0.3
    deploy:
      mode: replicated
      replicas: 2
    depends_on:
      - obama_postgres
  obama_postgres:
    container_name: obama_postgres
    image: postgres:13.5
    ports:
      - "5432:5432"
    networks:
      obama_network:
        ipv4_address: 170.0.0.2
    environment:
      POSTGRES_USER: "OBA_ADMIN"
      POSTGRES_PASSWORD: "OBA_LOCAL"



